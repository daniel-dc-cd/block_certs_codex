# block_certs_codex

## Intent

This guide is a work in progress and should not be considered a completed guide, however, the goal of this document is to be a complete guide to creating, issuing and viewing Blockcert certificates. As the Blockcerts technology changes so will, hopefully, this guide.

## Guide start

First clone the cert-tools package from [here](https://github.com/blockchain-certificates/cert-tools). 

A few things are going to occur in this package, first we're going to modify some settings to create a custom template, then we're going to use that template in conjunction with our roster.csv file to generate some unsigned certificates which we will send to our cert-issuer.

Follow the installation procedure outlined in the readme of the link from above.

## Overview

> See sample_data for example configuration and output. conf-mainnet.ini was used to create a batch of 2 unsigned certificates on the Bitcoin blockchain.

> The steps are:

+ Create the template
    + Update the config file to contain the correct data to populate the certificates
    + Place the needed images in images/ and point to them in the config file

+ Run create_certificate_template.py, which resulted in the certificate template /certificate_templates/test.json
    + Instantiate the batch
    + Add the recipient roster (in this case rosters/roster_testnet.csv) with the recipient's Bitcoin addresses.
    + Run 'instantiate_certificate_batch.py', which resulted in the files in unsigned_certificates

+ Then the unsigned certificates were copied to cert-issuer for signing and issuing on the blockchain.

# 1 - Creating the template

## Changing Images

To change the logo image and the signature image you will need to add the image files to the images folder inside sample_data and then make some adjustments to the conf.ini file. Look for the #images tag and there you can replace the default images file names with the names of the files you just uploaded. 

## Changing the text on the certificate.

When a user goes to view the certificate they are going to see text from the certificate as well as some text that is generated by the cert-viewer. The issuer and certificate information fields can be replaced with custom data on the conf.ini while some of the other text and images should be changed in the cert-viewer code.

The issuer_public_key=ecdsa-koblitz-pubkey: is generated from the bitcoin wallet you will use when switching from "regtest" to "testnet" or "mainnet" coins. For now, just use the defualt values.

## Adding a Custom field (WIP)
By incorporating your own JSON-LD inforamtion you'll be able to add to the context of the certificate. After adding some inforation to both your roster.csv and the conf.ini file you will still need to modify the cert-viewer if you want the custom field to render in the html.

First, add this line to the end of your conf.ini file

 `additional_per_recipient_fields = {"fields": [{"path": "$.xyz_custom_field","value": "*|XYZ_PLACEHOLDER|*","csv_column": "xyz_custom_field"}]}`

This will create the field `$.xyz_custom_field` in the larger context of the JSON-LD that will later get merged with the information from multiple sources. The `value` is the merge tag which is used as a placeholder in the template until information from the csv file can get incorporated. The `csv_column` is the name of the column in the roster.csv file which will provide the data for each recipient.

## Changing the roster
By default the file create_v2_template.py file will use the conf.ini settings and pull This file is located in the sample_data folder and you should edit this to add more or less recipients.

Now add the `xyz_custom_field` to the roster_testnet.csv file. Your file should look something like this

```
name,pubkey,identity,xyz_custom_field
Eularia Landroth,ecdsa-koblitz-pubkey:mtr98kany9G1XYNU74pRnfBQmaCg2FZLmc,eularia@landroth.org,xyz custom info 1!
Mcallister Greenborough,ecdsa-koblitz-pubkey:mkwntSiQmc14H65YxwckLenxY3DsEpvFbe,mcallister@greenborough.org,xyz custom info 1!
```

Next up we're going to modify the `create_v2_template.py` file. Look around like 91 and change to this:

```
    assertion = {
        '@context': [
            OPEN_BADGES_V2_CONTEXT, 
            BLOCKCERTS_V2_CONTEXT,
            {
                "xyz_custom_field" : {
                "@id": "http://schema.org/ComputerLanguage"
                }
            }
            
        ],
```

I'm still learning JSON-LD but what I think is going on here is we're adding our own custom field named "xyz_custom_field" and changing the default JSON-LD context to include our custom field and make it shorthand for the the link we included in the `@id` field. How the schema integrates with the roster csv file is still kind of a mystery to me so if you know please share!

## Creating the template!

Now that we've changed some text, modified some images, and added a custom field into we can generate a template. 

Use this command from the **cert-tools** directory.

`python cert_tools/create_v2_certificate_template.py -c conf.ini` 

If there aren't any errors you should have created a template and you can find the file `test_template.json` in the sample_data/certificates folder. You can open it up and inspect it to see if your customized information was added before you move on.

# 2 - Instantiating a batch

## Overview
Here we're going to use the information stored in the template and the roster file to create some unsigned certificates, these will be JSON files that we'll copy into our quick start Docker imaage to issue the certificates.

Once your roster_testnet.csv is populated with information to your liking, run this command.

`python cert_tools/instantiate_v2_certificate_batch.py -c conf.ini`

If all goes well, you should see that some files have appeared in the unsigned certificates folder. There should be as many json files are there are recipients.

These files should now be ready to be copied to the cert-issuer.

# 3 - Setting up the cert-issuer








